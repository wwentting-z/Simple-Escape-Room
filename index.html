<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Escape Room Â· Two Rooms (Hard Room 2, Fixed Room 1)</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, sans-serif;
    }

    body {
      background: radial-gradient(circle at top, #2b2f4a 0, #111322 55%, #05060a 100%);
      color: #f5f5f5;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }

    .game-container {
      width: 900px;
      max-width: 95%;
      background: rgba(15, 17, 30, 0.98);
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.65);
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .room-view {
      position: relative;
      padding: 18px 18px 14px;
      background: radial-gradient(circle at top left, #353c63 0, #191b2b 35%, #080812 100%);
    }

    .room-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .room-title {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: 0.5px;
    }

    .status-pill {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(0, 153, 255, 0.12);
      border: 1px solid rgba(0, 153, 255, 0.6);
      color: #b9e1ff;
    }

    .room-scene {
      position: relative;
      margin-top: 8px;
      border-radius: 16px;
      background: linear-gradient(to bottom, #20253b 0%, #151724 45%, #05060c 100%);
      height: 320px;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    .scene-layer {
      position: absolute;
      inset: 0;
    }

    .wall {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 62%;
      background: linear-gradient(to bottom, #252845, #151724);
    }

    .floor {
      position: absolute;
      left: -10%;
      right: -10%;
      bottom: -5%;
      height: 45%;
      background: radial-gradient(circle at 50% -40%, #696a7c 0, #343546 42%, #111321 75%);
      transform: perspective(500px) rotateX(70deg);
      transform-origin: top;
    }

    .door {
      position: absolute;
      right: 14%;
      bottom: 6%;
      width: 90px;
      height: 210px;
      background: linear-gradient(135deg, #3b2c1a, #5b3b22);
      border-radius: 6px;
      box-shadow: 0 0 0 2px rgba(5,5,5,0.9), inset 0 0 12px rgba(0,0,0,0.5);
      cursor: pointer;
      transition: transform 0.14s ease, box-shadow 0.14s ease, filter 0.14s ease;
    }

    .door:hover {
      transform: translateY(-1px);
      box-shadow: 0 0 0 2px rgba(255,255,255,0.18), 0 10px 20px rgba(0,0,0,0.7);
      filter: brightness(1.07);
    }

    .door::before {
      content: "";
      position: absolute;
      top: 50%;
      left: 18px;
      width: 9px;
      height: 9px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #ffd27f, #c4902f);
      box-shadow: 0 0 8px rgba(255, 210, 127, 0.8);
    }

    .door-label {
      position: absolute;
      bottom: -22px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 12px;
      opacity: 0.65;
    }

    .painting {
      position: absolute;
      top: 16%;
      left: 18%;
      width: 140px;
      height: 95px;
      border-radius: 9px;
      background: linear-gradient(135deg, #4456b0, #8a9efd);
      box-shadow: 0 0 0 4px #20253b, 0 0 0 1px rgba(0,0,0,0.8);
      cursor: pointer;
      transition: transform 0.14s ease, box-shadow 0.14s ease, filter 0.14s ease;
      overflow: hidden;
    }

    .painting:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 18px rgba(0,0,0,0.6);
      filter: brightness(1.09);
    }

    .painting-inner {
      position: absolute;
      inset: 6px;
      border-radius: 6px;
      background: radial-gradient(circle at 20% 20%, #f3f5ff 0, #8da4ff 35%, #354195 90%);
    }

    .painting-sun {
      position: absolute;
      top: 20%;
      left: 20%;
      width: 20px;
      height: 20px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #fff9d6, #ffd36f, #f1a03a);
    }

    .painting-hill {
      position: absolute;
      bottom: -5px;
      left: 0;
      right: 0;
      height: 40px;
      background: radial-gradient(circle at 50% -80%, #7fd59a, #2d8c60);
    }

    .painting-label {
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 12px;
      opacity: 0.7;
    }

    .desk {
      position: absolute;
      left: 18%;
      bottom: 5%;
      width: 220px;
      height: 90px;
      transform: perspective(500px) rotateX(10deg);
      transform-origin: bottom;
      cursor: pointer;
    }

    .desk-top {
      position: absolute;
      top: -12px;
      left: -8px;
      right: -8px;
      height: 26px;
      background: linear-gradient(135deg, #4b3423, #714930);
      border-radius: 12px;
      box-shadow: 0 10px 18px rgba(0,0,0,0.8);
    }

    .desk-body {
      position: absolute;
      inset: 0;
      border-radius: 10px;
      background: linear-gradient(to bottom, #3a291e, #25160f);
      box-shadow: 0 0 0 1px rgba(0,0,0,0.9);
    }

    .drawer {
      position: absolute;
      left: 12%;
      right: 12%;
      height: 30px;
      top: 32px;
      border-radius: 6px;
      background: radial-gradient(circle at 50% -50%, #8a6040, #4b2e1a);
      box-shadow: inset 0 0 8px rgba(0,0,0,0.7);
    }

    .drawer-knob {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #f7f3e7, #c9c1a0);
      box-shadow: 0 0 6px rgba(0,0,0,0.7);
    }

    .desk-label {
      position: absolute;
      bottom: -20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 12px;
      opacity: 0.7;
    }

    .bin {
      position: absolute;
      right: 32%;
      bottom: 12%;
      width: 48px;
      height: 65px;
      border-radius: 10px 10px 8px 8px;
      background: linear-gradient(135deg, #454b5e, #252837);
      box-shadow: 0 8px 16px rgba(0,0,0,0.7);
      cursor: pointer;
      overflow: hidden;
    }

    .bin::before {
      content: "";
      position: absolute;
      top: 4px;
      left: 6px;
      right: 6px;
      height: 4px;
      border-radius: 999px;
      background: radial-gradient(circle at 50% 0, #ffffff, #c3c7d7);
      opacity: 0.8;
    }

    .bin-stripe {
      position: absolute;
      inset: 12px 10px 8px;
      border-radius: 6px;
      border: 2px solid rgba(0,0,0,0.6);
      border-top-color: rgba(255,255,255,0.2);
      opacity: 0.9;
    }

    .bin-label {
      position: absolute;
      bottom: -20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 12px;
      opacity: 0.7;
    }

    /* Bookshelf / poster (Room 2 South wall) */
    .bookshelf {
      position: absolute;
      left: 16%;
      bottom: 5%;
      width: 260px;
      height: 150px;
      border-radius: 10px;
      background: linear-gradient(to bottom, #2b2738, #171320);
      box-shadow: 0 0 0 1px rgba(0,0,0,0.9), 0 12px 20px rgba(0,0,0,0.8);
      cursor: pointer;
    }

    .shelf-row {
      position: absolute;
      left: 10px;
      right: 10px;
      height: 26px;
      border-radius: 6px;
      background: rgba(10,10,20,0.9);
      border: 1px solid rgba(255,255,255,0.05);
    }

    .shelf-row:nth-child(1) { top: 15px; }
    .shelf-row:nth-child(2) { top: 56px; }
    .shelf-row:nth-child(3) { top: 97px; }

    .book {
      position: absolute;
      top: 3px;
      width: 18px;
      height: 20px;
      border-radius: 3px;
      background: #565a8b;
    }

    .book.red { background: #e85b6b; }
    .book.green { background: #4aba7a; }
    .book.yellow { background: #f3c96b; }
    .book.blue { background: #5a8ef3; }

    .poster {
      position: absolute;
      right: 13%;
      top: 18%;
      width: 120px;
      height: 90px;
      border-radius: 8px;
      background: linear-gradient(135deg, #5f4aa0, #c38beb);
      cursor: pointer;
      box-shadow: 0 0 0 2px rgba(0,0,0,0.9);
    }

    .poster-label {
      position: absolute;
      top: -18px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 12px;
      opacity: 0.75;
    }

    /* Crate (Room 2 West wall) */
    .crate {
      position: absolute;
      left: 26%;
      bottom: 8%;
      width: 160px;
      height: 100px;
      border-radius: 8px;
      background: linear-gradient(135deg, #6b5137, #4b361f);
      box-shadow: 0 12px 20px rgba(0,0,0,0.8);
      cursor: pointer;
    }

    .crate::before {
      content: "";
      position: absolute;
      inset: 10px;
      border-radius: 4px;
      border: 2px solid rgba(0,0,0,0.8);
      border-top-color: rgba(255,255,255,0.2);
    }

    .crate-label {
      position: absolute;
      bottom: -20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 12px;
      opacity: 0.8;
    }

    .scribble {
      position: absolute;
      right: 16%;
      top: 18%;
      width: 120px;
      height: 70px;
      border-radius: 6px;
      border: 1px dashed rgba(255,255,255,0.35);
      font-size: 11px;
      padding: 4px 6px;
      opacity: 0.8;
      cursor: pointer;
    }

    /* Arrows (for room 2 only) */
    .arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 32px;
      height: 48px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.35);
      background: rgba(5, 7, 16, 0.9);
      display: none;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      box-shadow: 0 6px 12px rgba(0,0,0,0.6);
      opacity: 0.9;
      user-select: none;
    }

    .arrow-left {
      left: 8px;
    }

    .arrow-right {
      right: 8px;
    }

    .arrow:hover {
      filter: brightness(1.15);
    }

    /* Info area under the scene */
    .info-area {
      margin-top: 10px;
      border-radius: 14px;
      background: rgba(5, 7, 16, 0.98);
      border: 1px solid rgba(255,255,255,0.06);
      padding: 10px 10px 8px;
    }

    .status-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      gap: 10px;
      font-size: 12px;
    }

    .hint-text {
      text-align: right;
      opacity: 0.78;
    }

    .log-box {
      max-height: 120px;
      min-height: 60px;
      margin-top: 4px;
      padding: 6px 8px;
      background: rgba(3, 5, 12, 0.95);
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.06);
      overflow-y: auto;
      font-size: 13px;
      line-height: 1.45;
    }

    .log-line {
      margin-bottom: 3px;
      opacity: 0.9;
    }

    .log-line.system {
      color: #8dd9ff;
    }

    .log-line.hint {
      color: #ffd58c;
    }

    .log-line.success {
      color: #7fffd3;
    }

    .log-line.fail {
      color: #ff9797;
    }

    .log-line span.prefix {
      opacity: 0.65;
      margin-right: 4px;
    }

    .bottom-row {
      margin-top: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      font-size: 12px;
    }

    .inventory {
      flex: 1;
      padding: 6px 8px;
      background: rgba(7, 10, 22, 0.96);
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.06);
    }

    .inventory-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      opacity: 0.7;
      margin-bottom: 2px;
    }

    .inventory-items {
      min-height: 18px;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 7px 14px;
      font-size: 13px;
      cursor: pointer;
      transition: transform 0.1s.ease, box-shadow 0.1s.ease, filter 0.1s.ease;
      white-space: nowrap;
    }

    .btn:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: none !important;
    }

    .btn-secondary {
      background: transparent;
      color: #d7d7e5;
      border: 1px solid rgba(255,255,255,0.18);
    }

    .btn-secondary:hover {
      filter: brightness(1.05);
      box-shadow: 0 0 0 1px rgba(255,255,255,0.16);
    }

    .btn-small {
      padding: 6px 12px;
      font-size: 12px;
    }

    /* Prompt overlay */
    .prompt-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 20;
    }

    .prompt-box {
      width: 320px;
      max-width: 90%;
      background: #151825;
      border-radius: 16px;
      padding: 18px 18px 14px;
      box-shadow: 0 18px 38px rgba(0,0,0,0.8);
      border: 1px solid rgba(255,255,255,0.12);
    }

    .prompt-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .prompt-text {
      font-size: 13px;
      opacity: 0.78;
      margin-bottom: 10px;
    }

    .prompt-input {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.18);
      background: #0e1018;
      color: #f5f5f5;
      font-size: 14px;
      outline: none;
      margin-bottom: 10px;
    }

    .prompt-input:focus {
      border-color: rgba(0, 199, 255, 0.8);
      box-shadow: 0 0 0 1px rgba(0,199,255,0.3);
    }

    .prompt-actions {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }

    @media (max-width: 700px) {
      .room-scene {
        height: 260px;
      }
      .status-row {
        flex-direction: column;
        align-items: flex-start;
      }
      .hint-text {
        text-align: left;
      }
      .bottom-row {
        flex-direction: column;
        align-items: stretch;
      }
      .btn-small {
        align-self: flex-end;
      }
    }
  </style>
</head>
<body>
<div class="game-container">
  <div class="room-view">
    <div class="room-header">
      <div class="room-title" id="room-title">Escape Room Â· Room 1</div>
      <div class="status-pill" id="status-pill">Trapped</div>
    </div>

    <div class="room-scene">
      <!-- Room 1 scene -->
      <div id="room1-scene" class="scene-layer">
        <div class="wall"></div>
        <div class="floor"></div>

        <div class="painting" onclick="clickPainting1()">
          <div class="painting-inner">
            <div class="painting-sun"></div>
            <div class="painting-hill"></div>
          </div>
          <div class="painting-label">Painting</div>
        </div>

        <div class="desk" onclick="clickDesk1()">
          <div class="desk-top"></div>
          <div class="desk-body"></div>
          <div class="drawer">
            <div class="drawer-knob"></div>
          </div>
          <div class="desk-label">Desk</div>
        </div>

        <div class="bin" onclick="clickBin1()">
          <div class="bin-stripe"></div>
          <div class="bin-label">Trash can</div>
        </div>

        <div class="door" onclick="clickDoor1()">
          <div class="door-label">Door (3-digit lock)</div>
        </div>
      </div>

      <!-- Room 2 North wall (door + painting) -->
      <div id="room2-north" class="scene-layer" style="display:none;">
        <div class="wall"></div>
        <div class="floor"></div>

        <div class="painting" onclick="clickPainting2North()">
          <div class="painting-inner">
            <div class="painting-sun"></div>
            <div class="painting-hill"></div>
          </div>
          <div class="painting-label">Wall Painting</div>
        </div>

        <div class="door" onclick="clickDoor2()">
          <div class="door-label">Door (Code Lock)</div>
        </div>
      </div>

      <!-- Room 2 East wall (desk with notes) -->
      <div id="room2-east" class="scene-layer" style="display:none;">
        <div class="wall"></div>
        <div class="floor"></div>

        <div class="desk" onclick="clickDesk2()">
          <div class="desk-top"></div>
          <div class="desk-body"></div>
          <div class="desk-label">Desk (Notes)</div>
        </div>
      </div>

      <!-- Room 2 South wall (bookshelf + poster) -->
      <div id="room2-south" class="scene-layer" style="display:none;">
        <div class="wall"></div>
        <div class="floor"></div>

        <div class="bookshelf" onclick="clickBookshelf2()">
          <div class="shelf-row">
            <div class="book red" style="left:8px;"></div>
            <div class="book blue" style="left:32px;"></div>
            <div class="book yellow" style="left:56px;"></div>
            <div "class="book green" style="left:80px;"></div>
          </div>
          <div class="shelf-row">
            <div class="book green" style="left:12px;"></div>
            <div class="book red" style="left:36px;"></div>
            <div class="book yellow" style="left:60px;"></div>
            <div class="book blue" style="left:84px;"></div>
          </div>
          <div class="shelf-row">
            <div class="book yellow" style="left:16px;"></div>
            <div class="book blue" style="left:40px;"></div>
            <div class="book red" style="left:64px;"></div>
            <div class="book green" style="left:88px;"></div>
          </div>
        </div>

        <div class="poster" onclick="clickPoster2()">
          <div class="poster-label">Wall Sketch</div>
        </div>
      </div>

      <!-- Room 2 West wall (crate + scribble) -->
      <div id="room2-west" class="scene-layer" style="display:none;">
        <div class="wall"></div>
        <div class="floor"></div>

        <div class="crate" onclick="clickCrate2()">
          <div class="crate-label">Wooden Crate (3-digit lock)</div>
        </div>

        <div class="scribble" onclick="clickScribble2()">
            Light reveals order. Order reveals numbers.
        </div>
      </div>

      <!-- Arrows (Room 2 only) -->
      <div class="arrow arrow-left" id="arrow-left" onclick="turnLeft()">â—€</div>
      <div class="arrow arrow-right" id="arrow-right" onclick="turnRight()">â–¶</div>
    </div>

    <div class="info-area">
      <div class="status-row">
        <div id="info-label">Log & Status</div>
        <div class="hint-text" id="hint-text">Hint: Room 1 â€“ start by checking the desk and the painting.</div>
      </div>

      <div class="log-box" id="log-box"></div>

      <div class="bottom-row">
        <div class="inventory">
          <div class="inventory-title">Inventory</div>
          <div class="inventory-items" id="inventory-items">(empty)</div>
        </div>
        <button class="btn btn-secondary btn-small" onclick="resetGame()">Restart</button>
      </div>
    </div>
  </div>
</div>

<!-- Prompt overlay -->
<div class="prompt-overlay" id="prompt-overlay">
  <div class="prompt-box">
    <div class="prompt-title" id="prompt-title">Enter Code</div>
    <div class="prompt-text" id="prompt-text">Enter the code:</div>
    <input type="text" id="prompt-input" class="prompt-input" />
    <div class="prompt-actions">
      <button class="btn btn-secondary" onclick="closePrompt()">Cancel</button>
      <button class="btn btn-secondary" style="border-color:rgba(0,199,255,0.6);" onclick="confirmPrompt()">OK</button>
    </div>
  </div>
</div>

<script>
    const state = {
      level: 1,
      // room 1
      hasSeenDeskNote1: false,
      hasSeenPaintingBack1: false,
      door1Unlocked: false,
      binChecked1: false,
      // room 2
      room2ViewIndex: 0,
      hasShelfNumbers2: false,
      hasDeskCrateHint2: false,
      crateUnlocked2: false,
      hasFlashlight2: false,
      paintingRevealed2: false,
      hasShapeNote2: false,
      hasDoorOrderHint2: false,
      scribbleSeen2: false,
      door2Unlocked: false,
      gameOver: false,
      promptCallback: null
    };
  
    const logBox = document.getElementById("log-box");
    const inventoryBox = document.getElementById("inventory-items");
    const statusPill = document.getElementById("status-pill");
    const hintText = document.getElementById("hint-text");
    const roomTitle = document.getElementById("room-title");
    const infoLabel = document.getElementById("info-label");
  
    const promptOverlay = document.getElementById("prompt-overlay");
    const promptTitle = document.getElementById("prompt-title");
    const promptText = document.getElementById("prompt-text");
    const promptInput = document.getElementById("prompt-input");
  
    const room1Scene = document.getElementById("room1-scene");
    const room2North = document.getElementById("room2-north");
    const room2East = document.getElementById("room2-east");
    const room2South = document.getElementById("room2-south");
    const room2West = document.getElementById("room2-west");
    const arrowLeft = document.getElementById("arrow-left");
    const arrowRight = document.getElementById("arrow-right");
  
    function addLog(text, type = "normal") {
      const line = document.createElement("div");
      line.className = "log-line " + (type !== "normal" ? type : "");
      const prefix = document.createElement("span");
      prefix.className = "prefix";
      prefix.textContent = type === "system" ? "[System]" :
                           type === "hint" ? "[Hint]" :
                           type === "success" ? "[Success]" :
                           type === "fail" ? "[Fail]" :
                                             "Â·";
      line.appendChild(prefix);
      line.appendChild(document.createTextNode(text));
      logBox.appendChild(line);
      logBox.scrollTop = logBox.scrollHeight;
    }
  
    function updateInventory() {
      const items = [];
      if (state.hasFlashlight2 && state.level === 2) items.push("ðŸ”¦ UV Flashlight");
      inventoryBox.textContent = items.length ? items.join(", ") : "(empty)";
    }
  
    function setStatus(text, colorClass) {
      statusPill.textContent = text;
      if (colorClass === "safe") {
        statusPill.style.background = "rgba(0, 255, 153, 0.1)";
        statusPill.style.borderColor = "rgba(0, 255, 153, 0.6)";
        statusPill.style.color = "#9fffd7";
      } else if (colorClass === "danger") {
        statusPill.style.background = "rgba(255, 99, 132, 0.12)";
        statusPill.style.borderColor = "rgba(255, 99, 132, 0.6)";
        statusPill.style.color = "#ffb3c4";
      } else {
        statusPill.style.background = "rgba(0, 153, 255, 0.12)";
        statusPill.style.borderColor = "rgba(0, 153, 255, 0.6)";
        statusPill.style.color = "#b9e1ff";
      }
    }
  
    function setHint(text) {
      hintText.textContent = text;
    }
  
    function openPrompt(options) {
      promptTitle.textContent = options.title || "Input";
      promptText.textContent = options.text || "";
      promptInput.value = "";
      state.promptCallback = options.onConfirm || null;
      promptOverlay.style.display = "flex";
      promptInput.focus();
    }
  
    function closePrompt() {
      promptOverlay.style.display = "none";
      state.promptCallback = null;
    }
  
    function confirmPrompt() {
      const value = promptInput.value.trim();
      const cb = state.promptCallback;
      closePrompt();
      if (cb) cb(value);
    }
  
    /* ---------- Room 1 ---------- */
  
    function clickDesk1() {
      if (state.gameOver || state.level !== 1) return;
      if (!state.hasSeenDeskNote1) {
        state.hasSeenDeskNote1 = true;
      }
      addLog("On the desk you see a short sentence:", "system");
      addLog("\"The code is behind beauty.\"", "hint");
      setHint("Room 1 â€“ Maybe the 'beauty' is the painting on the wall.");
    }
  
    function clickPainting1() {
      if (state.gameOver || state.level !== 1) return;
      if (!state.hasSeenPaintingBack1) {
        state.hasSeenPaintingBack1 = true;
      }
      addLog("You lift the painting from the wall. There is a note taped to the back:", "system");
      addLog("The note shows a 3-digit number: 734.", "hint");
      setHint("Room 1 â€“ Try using 734 on the door's lock.");
    }
  
    function clickBin1() {
      if (state.gameOver || state.level !== 1) return;
      if (!state.binChecked1) {
        state.binChecked1 = true;
      }
      addLog("You search the trash can. Just empty cups and crumpled paper, nothing useful.", "system");
      setHint("Room 1 â€“ The answer is probably not in the trash. Focus on the desk, painting, and door.");
    }
  
    function clickDoor1() {
      if (state.gameOver || state.level !== 1) return;
      addLog("The door has a small 3-digit code lock.", "system");
      openPrompt({
        title: "Door Lock (Room 1)",
        text: "Enter the 3-digit code (hint: desk + painting):",
        onConfirm: (value) => {
          if (value === "734") {
            if (!state.door1Unlocked) {
              state.door1Unlocked = true;
              addLog("You enter 7 3 4 and turn the handleâ€”", "system");
              addLog("The lock opens! You step through the door.", "success");
              addLog("But there is another room waiting for you...", "system");
              startRoom2();
            } else {
              addLog("The door is already unlocked. You can move on.", "success");
            }
          } else {
            addLog("The lock doesn't move. That code seems wrong.", "fail");
          }
        }
      });
    }
  
    /* ---------- Room 2: setup & view ---------- */
  
    function showRoom1Scene() {
      room1Scene.style.display = "block";
      room2North.style.display = "none";
      room2East.style.display = "none";
      room2South.style.display = "none";
      room2West.style.display = "none";
      arrowLeft.style.display = "none";
      arrowRight.style.display = "none";
    }
  
    function updateRoom2View() {
      if (state.level !== 2) return;
      room2North.style.display = "none";
      room2East.style.display = "none";
      room2South.style.display = "none";
      room2West.style.display = "none";
  
      if (state.room2ViewIndex === 0) room2North.style.display = "block";
      else if (state.room2ViewIndex === 1) room2East.style.display = "block";
      else if (state.room2ViewIndex === 2) room2South.style.display = "block";
      else if (state.room2ViewIndex === 3) room2West.style.display = "block";
    }
  
    function startRoom2() {
      state.level = 2;
      state.room2ViewIndex = 0;
  
      state.hasShelfNumbers2 = false;
      state.hasDeskCrateHint2 = false;
      state.crateUnlocked2 = false;
      state.hasFlashlight2 = false;
      state.paintingRevealed2 = false;
      state.hasShapeNote2 = false;
      state.hasDoorOrderHint2 = false;
      state.scribbleSeen2 = false;
      state.door2Unlocked = false;
  
      updateInventory();
  
      room1Scene.style.display = "none";
      arrowLeft.style.display = "flex";
      arrowRight.style.display = "flex";
      updateRoom2View();
  
      roomTitle.textContent = "Escape Room Â· Room 2";
      infoLabel.textContent = "Log & Status (Room 2)";
      setStatus("Trapped (Room 2)", "normal");
      setHint("Room 2 â€“ Turn left/right to see all four walls and gather clues.");
      addLog("You enter Room 2. Another locked door, and this time the puzzle looks complicated.", "system");
    }
  
    function turnLeft() {
      if (state.level !== 2 || state.gameOver) return;
      state.room2ViewIndex = (state.room2ViewIndex + 3) % 4;
      updateRoom2View();
      addLog("You turn to face another wall.", "system");
    }
  
    function turnRight() {
      if (state.level !== 2 || state.gameOver) return;
      state.room2ViewIndex = (state.room2ViewIndex + 1) % 4;
      updateRoom2View();
      addLog("You turn to face another wall.", "system");
    }
  
    function requireRoom2() {
      if (state.level !== 2 || state.gameOver) return false;
      return true;
    }
  
    /* ---------- Room 2 North (painting + door) ---------- */
  
    function clickPainting2North() {
      if (!requireRoom2()) return;
      if (state.room2ViewIndex !== 0) return;
  
      if (!state.hasFlashlight2) {
        addLog("The wall painting looks normal. Maybe something is hidden, but you need a special light.", "hint");
        return;
      }
  
      if (!state.paintingRevealed2) {
        state.paintingRevealed2 = true;
      }
      addLog("You shine the UV flashlight on the painting.", "system");
      addLog("Glowing symbols appear in a row:", "system");
      addLog("â–²   â—   â–    â˜…", "hint");
      setHint("Room 2 â€“ Remember this exact order of shapes.");
    }
  
    function clickDoor2() {
      if (!requireRoom2()) return;
      if (state.room2ViewIndex !== 0) {
        addLog("You need to face the door to use the lock.", "system");
        return;
      }
      addLog("The door has a 4-digit code lock.", "system");
      openPrompt({
        title: "Door Code (Room 2)",
        text: "Enter the 4-digit code (hint: glowing shapes + shape numbers):",
        onConfirm: (value) => {
          // ç”»ä¸­é¡ºåºï¼šâ–² â— â–  â˜…  â†’ æ•°å­—ï¼š2 5 7 9
          if (value === "2579") {
            state.door2Unlocked = true;
            state.gameOver = true;
            addLog("You enter 2 5 7 9 and press the handleâ€”", "system");
            addLog("The lock clicks open! The door swings outward.", "success");
            addLog("Congratulations, you escaped both rooms ðŸŽ‰", "success");
            setStatus("Escaped (All Rooms)", "safe");
            setHint("You win! Press \"Restart\" if you want to play again.");
          } else {
            addLog("The lock flashes red. Wrong code.", "fail");
            if (!state.hasFlashlight2 || !state.paintingRevealed2 || !state.hasShapeNote2) {
              addLog("Maybe you haven't combined painting order + shape numbers correctly yet.", "hint");
            }
          }
        }
      });
    }
  
    /* ---------- Room 2 East (desk notes) ---------- */
  
    function clickDesk2() {
      if (!requireRoom2()) return;
      if (state.room2ViewIndex !== 1) {
        addLog("You can't reach the desk from this angle.", "system");
        return;
      }
  
      // ç¬¬ä¸€å¼ çº¸ï¼šcrate æç¤º
      if (!state.hasDeskCrateHint2) {
        state.hasDeskCrateHint2 = true;
        addLog("On the desk you find a note:", "system");
        addLog("\"Crate code = [smallest odd] [largest odd] [how many odd numbers] on the bottom shelf of the bookcase.\"", "hint");
        setHint("Room 2 â€“ Check the bookshelf bottom shelf to compute the crate code.");
        return;
      }
  
      // ç¬¬äºŒå¼ çº¸ï¼šé—¨ code è§„åˆ™ï¼ˆç”¨ painting é¡ºåº + å½¢çŠ¶æ•°å­—ï¼‰
      if (!state.hasDoorOrderHint2 && state.paintingRevealed2 && state.hasShapeNote2) {
        state.hasDoorOrderHint2 = true;
        addLog("Under the first note, you discover another piece of paper:", "system");
        addLog("\"Door code = the numbers of the glowing shapes, in that exact order.\"", "hint");
        addLog("\"First find the order on the painting, then use the shape legend.\"", "hint");
        setHint("Room 2 â€“ Door code = shape numbers, in the glowing order.");
        return;
      }
  
      // ä¸¤å¼ æç¤ºéƒ½è§£é”åŽï¼šé‡å¤ä¸¤æ¡çœŸæ­£æœ‰ç”¨çš„ hint
      if (state.hasDeskCrateHint2 && state.hasDoorOrderHint2) {
        addLog("You read the desk notes again:", "system");
        addLog("\"Crate code = [smallest odd] [largest odd] [how many odd numbers] on the bottom shelf of the bookcase.\"", "hint");
        addLog("\"Door code = the numbers of the glowing shapes, in that exact order.\"", "hint");
        return;
      }
  
      // åªè§£é”äº† crate çš„æ—¶å€™ï¼šé‡å¤ crate æç¤º
      addLog("You read the crate note again:", "system");
      addLog("\"Crate code = [smallest odd] [largest odd] [how many odd numbers] on the bottom shelf of the bookcase.\"", "hint");
    }
  
    /* ---------- Room 2 South (bookshelf + poster) ---------- */
  
    function clickBookshelf2() {
      if (!requireRoom2()) return;
      if (state.room2ViewIndex !== 2) {
        addLog("You can't reach the shelves from here.", "system");
        return;
      }
  
      // ç¬¬ä¸€æ­¥ï¼šæ•°å­—æ ‡ç­¾
      if (!state.hasShelfNumbers2) {
        state.hasShelfNumbers2 = true;
        addLog("You read the small number labels under each shelf:", "system");
        addLog("Top shelf:    3, 4, 6, 9", "hint");
        addLog("Middle shelf: 2, 5, 7, 8", "hint");
        addLog("Bottom shelf: 1, 3, 5, 9", "hint");
        setHint("Room 2 â€“ Use the bottom shelf odd numbers + desk note to open the crate.");
        return;
      }
  
      // ç¬¬äºŒæ­¥ï¼šå½¢çŠ¶æ•°å€¼è¡¨
      if (!state.hasShapeNote2) {
        state.hasShapeNote2 = true;
        addLog("You pull out one of the books. A folded note falls onto the shelf.", "system");
        addLog("The note shows a legend:", "system");
        addLog("â–²  Triangle  =  2", "hint");
        addLog("â—  Circle    =  5", "hint");
        addLog("â–   Square    =  7", "hint");
        addLog("â˜…  Star      =  9", "hint");
        setHint("Room 2 â€“ Combine painting order + this shape legend for the door code.");
        return;
      }
  
      // å·²ç»æ‹¿åˆ°æ•°å­—æ ‡ç­¾ + å½¢çŠ¶è¡¨ï¼šé‡å¤æ‰€æœ‰å…³é”®ä¿¡æ¯
      addLog("You look over the shelf notes again:", "system");
      addLog("Top shelf:    3, 4, 6, 9", "hint");
      addLog("Middle shelf: 2, 5, 7, 8", "hint");
      addLog("Bottom shelf: 1, 3, 5, 9", "hint");
      addLog("Shape legend:", "system");
      addLog("â–²  Triangle  =  2", "hint");
      addLog("â—  Circle    =  5", "hint");
      addLog("â–   Square    =  7", "hint");
      addLog("â˜…  Star      =  9", "hint");
    }
  
    function clickPoster2() {
      if (!requireRoom2()) return;
      if (state.room2ViewIndex !== 2) return;
      addLog("The wall sketch shows overlapping geometric shapes, like a reminder that each shape stands for a number.", "system");
    }
  
    /* ---------- Room 2 West (crate + scribble) ---------- */
  
    function clickCrate2() {
      if (!requireRoom2()) return;
      if (state.room2ViewIndex !== 3) {
        addLog("You can't examine the crate from this angle.", "system");
        return;
      }
  
      if (!state.crateUnlocked2) {
        addLog("The wooden crate has a small 3-digit lock.", "system");
        openPrompt({
          title: "Crate Lock",
          text: "Enter the 3-digit code (bottom shelf + desk hint):",
          onConfirm: (value) => {
            // bottom shelf: 1,3,5,9 -> odd: 1,3,5,9
            // smallest odd = 1, largest odd = 9, count = 4 -> 194
            if (value === "194") {
              state.crateUnlocked2 = true;
              if (!state.hasFlashlight2) {
                state.hasFlashlight2 = true;
                updateInventory();
                addLog("You hear a click and open the crate.", "success");
                addLog("Inside you find a small UV flashlight.", "success");
                setHint("Room 2 â€“ Try shining the UV flashlight on the painting.");
              }
            } else {
              addLog("The crate lock doesn't budge. Wrong code.", "fail");
              if (!state.hasShelfNumbers2 || !state.hasDeskCrateHint2) {
                addLog("Maybe you need to carefully use the bookshelf numbers and the desk hint.", "hint");
              }
            }
          }
        });
      } else {
        if (state.hasFlashlight2) {
          addLog("The crate is open. This is where you found the UV flashlight.", "system");
        } else {
          addLog("The crate is open but empty now.", "system");
        }
      }
    }
  
    function clickScribble2() {
      if (!requireRoom2()) return;
      if (state.room2ViewIndex !== 3) return;
  
      if (!state.scribbleSeen2) {
        state.scribbleSeen2 = true;
      }
      // æ”¹æˆä¸€ä¸ªè¾…åŠ©å°æç¤ºï¼Œä¸å†æœ‰å…¬å¼
      addLog("On the wall someone has scribbled:", "system");
      addLog("\"Light reveals order. Order reveals numbers.\"", "hint");
      addLog("\"If you know what each shape is worth, just read them in the line they glow.\"", "hint");
      setHint("Room 2 â€“ Door = shape numbers in the glowing painting order.");
    }
  
    /* ---------- Reset & init ---------- */
  
    function resetGame() {
      state.level = 1;
      state.hasSeenDeskNote1 = false;
      state.hasSeenPaintingBack1 = false;
      state.door1Unlocked = false;
      state.binChecked1 = false;
  
      state.room2ViewIndex = 0;
      state.hasShelfNumbers2 = false;
      state.hasDeskCrateHint2 = false;
      state.crateUnlocked2 = false;
      state.hasFlashlight2 = false;
      state.paintingRevealed2 = false;
      state.hasShapeNote2 = false;
      state.hasDoorOrderHint2 = false;
      state.scribbleSeen2 = false;
      state.door2Unlocked = false;
  
      state.gameOver = false;
      state.promptCallback = null;
  
      logBox.innerHTML = "";
      showRoom1Scene();
      updateInventory();
      roomTitle.textContent = "Escape Room Â· Room 1";
      infoLabel.textContent = "Log & Status";
      setStatus("Trapped", "normal");
      setHint("Hint: Room 1 â€“ Check the desk, painting, and then try the door.");
  
      addLog("You wake up in a small unfamiliar room. The door is locked.", "system");
      addLog("In Room 1 there is a desk, a painting, a trash can, and a door with a 3-digit lock.", "system");
    }
  
    resetGame();
  
    document.addEventListener("keydown", (e) => {
      if (promptOverlay.style.display === "flex" && e.key === "Enter") {
        e.preventDefault();
        confirmPrompt();
      }
    });
  </script>
  
  
</body>
</html>
